"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[2696],{4467:e=>{e.exports=JSON.parse('{"permalink":"/eason-blog/blog/fasttext","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-02-16-fasttext/index.md","source":"@site/blog/2025-02-16-fasttext/index.md","title":"\u4f7f\u7528MLflow\u548cRay\u8bad\u7ec3fastText","description":"fastText\u662fFacebook\u7814\u53d1\u7684\u4e00\u6b3e\u9488\u5bf9NLP\u9886\u57df\u7684\u89e3\u51b3\u65b9\u6848\u3002","date":"2025-02-16T00:00:00.000Z","tags":[{"inline":false,"label":"Machine Learning","permalink":"/eason-blog/blog/tags/machine-learning","description":"Machine Learning related posts"},{"inline":false,"label":"MLflow","permalink":"/eason-blog/blog/tags/mlflow","description":"MLflow related posts"},{"inline":false,"label":"NLP","permalink":"/eason-blog/blog/tags/nlp","description":"Natural Language Processing (NLP) related posts"}],"readingTime":17.56,"hasTruncateMarker":true,"authors":[{"name":"Eason G.","title":"Engineer","url":"https://github.com/e10101","page":{"permalink":"/eason-blog/blog/authors/eason"},"socials":{"github":"https://github.com/e10101"},"imageURL":"https://github.com/e10101.png","key":"eason"}],"frontMatter":{"slug":"fasttext","title":"\u4f7f\u7528MLflow\u548cRay\u8bad\u7ec3fastText","authors":"eason","tags":["ml","mlflow","nlp"]},"unlisted":false,"prevItem":{"title":"\u57fa\u4e8eDocker\u7684\u673a\u5668\u5b66\u4e60\u5f00\u53d1\u73af\u5883","permalink":"/eason-blog/blog/ml-env-setup"},"nextItem":{"title":"MLflow\u4fdd\u5b58\u4e0e\u4f7f\u7528\u6a21\u578b","permalink":"/eason-blog/blog/mlflow-log-model"}}')},8176:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var l=t(4467),s=t(3420),r=t(8356);const i={slug:"fasttext",title:"\u4f7f\u7528MLflow\u548cRay\u8bad\u7ec3fastText",authors:"eason",tags:["ml","mlflow","nlp"]},a=void 0,c={authorsImageUrls:[void 0]},d=[{value:"fastText\u4ecb\u7ecd",id:"fasttext\u4ecb\u7ecd",level:2},{value:"\u8bad\u7ec3\u76ee\u6807",id:"\u8bad\u7ec3\u76ee\u6807",level:2},{value:"\u6570\u636e\u51c6\u5907",id:"\u6570\u636e\u51c6\u5907",level:2},{value:"\u6570\u636e\u6587\u4ef6\u683c\u5f0f",id:"\u6570\u636e\u6587\u4ef6\u683c\u5f0f",level:3},{value:"fastText\u8981\u6c42\u7684\u6570\u636e\u683c\u5f0f",id:"fasttext\u8981\u6c42\u7684\u6570\u636e\u683c\u5f0f",level:3},{value:"\u5904\u7406\u4ee3\u7801",id:"\u5904\u7406\u4ee3\u7801",level:3},{value:"\u8bad\u7ec3",id:"\u8bad\u7ec3",level:2},{value:"fastText\u8bad\u7ec3",id:"fasttext\u8bad\u7ec3",level:3},{value:"Ray Tune\u5bfb\u627e\u53c2\u6570",id:"ray-tune\u5bfb\u627e\u53c2\u6570",level:3},{value:"\u5b9a\u4e49\u53c2\u6570\u5bfb\u627e\u8303\u56f4",id:"\u5b9a\u4e49\u53c2\u6570\u5bfb\u627e\u8303\u56f4",level:3},{value:"\u53ef\u9009\u6b65\u9aa4",id:"\u53ef\u9009\u6b65\u9aa4",level:2},{value:"\u5bf9\u8bad\u7ec3\u5f02\u5e38\u8fdb\u884c\u5904\u7406",id:"\u5bf9\u8bad\u7ec3\u5f02\u5e38\u8fdb\u884c\u5904\u7406",level:3},{value:"\u8bb0\u5f55\u6a21\u578b",id:"\u8bb0\u5f55\u6a21\u578b",level:3},{value:"\u7ed3\u679c\u89e3\u6790",id:"\u7ed3\u679c\u89e3\u6790",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"fastText\u662fFacebook\u7814\u53d1\u7684\u4e00\u6b3e\u9488\u5bf9NLP\u9886\u57df\u7684\u89e3\u51b3\u65b9\u6848\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5176\u4e3b\u8981\u63d0\u4f9b\u4e86\u6587\u672c\u5206\u7c7b\u548c\u8bcd\u5411\u91cf\u5b66\u4e60\u4e24\u5927\u529f\u80fd\u3002\n\u5176\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u6574\u53e5\u8bdd\u7684\u8bcd\u5411\u91cf\u53e0\u52a0\u5e73\u5747\u4f5c\u4e3a\u6587\u672c\u8868\u793a\uff0c\n\u5e76\u4f7f\u7528softmax\u5206\u7c7b\u5668\u8fdb\u884c\u5206\u7c7b\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u901a\u8fc7\u672c\u6587\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528MLflow\u4ee5\u53caRay\u6765\u8bad\u7ec3\u6211\u4eec\u7684fastText\u6a21\u578b\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"fasttext\u4ecb\u7ecd",children:"fastText\u4ecb\u7ecd"}),"\n",(0,s.jsx)(n.p,{children:"fastText\u4f5c\u4e3a\u4e00\u4e2a\u9ad8\u6548\u7684\u6587\u672c\u5206\u7c7b\u548c\u8bcd\u5411\u91cf\u8868\u793a\u5de5\u5177\uff0cfastText\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8bad\u7ec3\u901f\u5ea6\u5feb"}),"\uff1a\u80fd\u591f\u5728\u666e\u901a\u591a\u6838CPU\u4e0a\u51e0\u79d2\u5185\u5904\u7406\u6570\u5341\u4ebf\u4e2a\u8bcd\uff0c\u8bad\u7ec3\u6570\u767e\u4e07\u4e2a\u6587\u672c\u5206\u7c7b\u5668"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6548\u679c\u4f18\u5f02"}),"\uff1a\u5728\u6587\u672c\u5206\u7c7b\u4efb\u52a1\u4e2d\u53d6\u5f97\u4e0e\u6df1\u5ea6\u5b66\u4e60\u6a21\u578b\u76f8\u5f53\u7684\u7cbe\u5ea6"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8d44\u6e90\u5360\u7528\u5c11"}),"\uff1a\u76f8\u6bd4\u6df1\u5ea6\u5b66\u4e60\u6a21\u578b\uff0cfastText\u5bf9\u786c\u4ef6\u8981\u6c42\u4f4e\uff0c\u4e14\u6a21\u578b\u6587\u4ef6\u5c0f"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u591a\u8bed\u8a00\u652f\u6301"}),"\uff1a\u652f\u6301294\u79cd\u8bed\u8a00\u7684\u8bcd\u5411\u91cf\u8bad\u7ec3"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u8bad\u7ec3\u76ee\u6807",children:"\u8bad\u7ec3\u76ee\u6807"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u4f1a\u9488\u5bf9",(0,s.jsx)(n.a,{href:"https://github.com/cooelf/DeepUtteranceAggregation/",children:"\u6dd8\u5b9d\u5ba2\u670d\u5bf9\u8bdd\u6570\u636e"}),"\n\u8fd9\u4e2a\u6570\u636e\u96c6\u8fdb\u884c\u5904\u7406\uff0c\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u8bad\u7ec3\u4e00\u4e2a\u5206\u7c7b\u5668\uff0c\n\u6765\u5bf9\u4efb\u610f\u5bf9\u8bdd\u6587\u672c\u533a\u5206\u662f\u5ba2\u6237\u8fd8\u662f\u5ba2\u670d\u7684\u6d88\u606f\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6570\u636e\u51c6\u5907",children:"\u6570\u636e\u51c6\u5907"}),"\n",(0,s.jsx)(n.h3,{id:"\u6570\u636e\u6587\u4ef6\u683c\u5f0f",children:"\u6570\u636e\u6587\u4ef6\u683c\u5f0f"}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u901a\u8fc7\u4e0a\u9762\u7684\u7f51\u5740\u4e0b\u8f7d\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u67093\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u5206\u522b\u662f ",(0,s.jsx)(n.code,{children:"train.txt"}),"\u3001 ",(0,s.jsx)(n.code,{children:"dev.txt"}),"\u4ee5\u53ca",(0,s.jsx)(n.code,{children:"test.txt"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6253\u5f00\u4efb\u610f\u7684\u6587\u4ef6\uff0c\u5176\u5185\u90e8\u6570\u636e\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"1 \u5728 \u5417 \u60a8\u597d \u73b0\u5728 \u62cd \u51e0\u5929 \u80fd \u5230 \u8fbd\u5b81 \u8fd9\u4e2a \u4e0d \u4e00\u5b9a \u54e6 \u5927\u6982 \u51e0\u5929 \u4e0d \u77e5\u9053 \u4e48 \u4e00\u822c \u60c5\u51b5 \u4e0b 3 \u5230 5 \u5929 \u5de6\u53f3\n0 \u5728 \u5417 \u60a8\u597d \u73b0\u5728 \u62cd \u51e0\u5929 \u80fd \u5230 \u8fbd\u5b81 \u8fd9\u4e2a \u4e0d \u4e00\u5b9a \u54e6 \u5927\u6982 \u51e0\u5929 \u4e0d \u77e5\u9053 \u4e48 \u4eb2 \u4e0d\u4f1a \u7684 \u5462 \u60a8 \u653e\u5fc3\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6bcf\u4e00\u884c\u8868\u793a\u4e3a\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"1"}),"\u6216",(0,s.jsx)(n.code,{children:"0"}),"\uff1a\u6b63\u786e\u7684\u5bf9\u8bdd\u6d41\u7a0b\u4ee5\u53ca\u9519\u8bef\u7684\u5bf9\u8bdd\u6d41\u7a0b\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5faa\u73af\uff08\u7528",(0,s.jsx)(n.code,{children:"\\t"}),"\u6765\u9694\u5f00\uff09\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5ba2\u6237\u95ee\u9898"}),"\n",(0,s.jsx)(n.li,{children:"\u5ba2\u670d\u56de\u7b54"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u6bd4\u5982\u4e0a\u9762\u7684\u6570\u636e\u6837\u672c\u7684\u7b2c\u4e00\u884c\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"1 --\x3e \u6b63\u786e\u7684\u5bf9\u8bdd\n\u5728 \u5417 --\x3e \u5ba2\u6237\u95ee\u9898\n\u60a8\u597d --\x3e \u5ba2\u670d\u56de\u7b54\n\u73b0\u5728 \u62cd \u51e0\u5929 \u80fd \u5230 \u8fbd\u5b81 \u8fd9\u4e2a \u4e0d \u4e00\u5b9a \u54e6 \u5927\u6982 \u51e0\u5929 \u4e0d \u77e5\u9053 \u4e48 --\x3e \u5ba2\u6237\u95ee\u9898\n\u4e00\u822c \u60c5\u51b5 \u4e0b 3 \u5230 5 \u5929 \u5de6\u53f3 --\x3e \u5ba2\u670d\u56de\u7b54\n"})}),"\n",(0,s.jsx)(n.h3,{id:"fasttext\u8981\u6c42\u7684\u6570\u636e\u683c\u5f0f",children:"fastText\u8981\u6c42\u7684\u6570\u636e\u683c\u5f0f"}),"\n",(0,s.jsx)(n.p,{children:"fastText\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u6570\u636e\u683c\u5f0f\uff0c\u5176\u8f93\u5165\u4e3a\u6587\u672c\u6587\u4ef6\uff0c\u5176\u6bcf\u4e00\u884c\u7684\u6570\u636e\u683c\u5f0f\u4e3a\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u5206\u7c7b1 \u5206\u7c7b2 \u5206\u7c7b... \u6587\u672c\u884c\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5373\uff0c\u6bcf\u4e00\u884c\u53ef\u4ee5\u5173\u8054\u591a\u4e2a\u5206\u7c7b\uff0c\u7136\u540e\u5206\u7c7b\u4fe1\u606f\u4ee5\u53ca\u6587\u672c\u884c\u4fe1\u606f\u4ee5\u7a7a\u683c\u9694\u5f00\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5176\u5206\u7c7b\u8868\u793a\u6709\u72ec\u7279\u7684\u8981\u6c42\uff0c\u6bd4\u5982\u6211\u4eec\u5e0c\u671b\u6784\u5efa\u4e24\u4e2a\u5206\u7c7b\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"seller"}),"\uff1a\u5ba2\u670d"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"customer"}),"\uff1a\u5ba2\u6237"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u90a3\u4e48\u5176fastText\u8868\u793a\u4e3a\uff1a ",(0,s.jsx)(n.code,{children:"__label__customer"}),"\u548c",(0,s.jsx)(n.code,{children:"__label__seller"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u5c06\u4e0a\u8ff0\u7684\u539f\u59cb\u6570\u636e\u6587\u4ef6\uff0c\u6bcf\u884c\u8fdb\u884c\u89e3\u6790\uff0c\u5e76\u6309\u7167\u5b58\u50a8\u5982\u4e0b\u7684\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u5982\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"__label__customer \u60a8\u597d\u54b1\u4eec\u8fd9\u8fb9\u5982\u679c\u80fd\u63d0\u5347\u60a8\u7684\u9500\u91cf\u5229\u6da6\u60a8\u4f1a\u8003\u8651\u8ddf\u6211\u4eec\u5408\u4f5c\u5417\n__label__customer \u4eb2\u4f60\u5bb6\u4ec0\u4e48\u65f6\u5019\u8fd8\u6709\u6d3b\u52a8\u554a\n__label__customer \u6211\u7684\u8ba2\u5355\u600e\u4e48\u4e24\u5929\u4e86\u6ca1\u4ec0\u4e48\u53d8\u5316\u554a\u5728\u4e48\n__label__customer \u597d\u9ebb\u70e6\u4f60\u6539\u4e0b\u8c22\u8c22\n__label__customer \u660e\u5929\u53ef\u4ee5\u53d1\u8d27\n__label__seller \u6709\u7684\u54e6\u6ee168\u900195g\u732a\u8089\u812f\u4e00\u888b\n__label__customer \u8fd9\u4e2a\u4e70\u4e24\u4e2a\u6709\u4f18\u60e0\u5417\n__label__customer \u4eb2\u4eb2\u5df2\u4e0b\u5355\u4e70\u8fd9\u4e48\u591a\u8bf7\u638c\u67dc\u7684\u591a\u9001\u70b9\u5c0f\u793c\u7269\u554a\n__label__customer \u55ef\u55ef\u4e86\u89e3\u4e86\u54e6\n__label__customer \u6211\u4e7010\u4e2a\u4ed8\u6b3e\u7684\u65f6\u5019\u600e\u4e48\u4e0d\u6253\u6298\u5462\n__label__seller \u60a8\u8fd9\u8fb9\u63d0\u4ea4\u8ba2\u5355\u770b\u770b\u54e6\u7cfb\u7edf\u81ea\u52a8\u6539\u4ef7\u7684\u548c\u8292\u679c\u5e72\u4e00\u6837\u7684\n__label__seller \u4e0d\u597d\u610f\u601d\u4eb2\u53ef\u80fd\u5feb\u9012\u9014\u4e2d\u6324\u538b\u9020\u6210\u7684\u8fd9\u8fb9\u9000\u4eb22\u5143\u5dee\u4ef7\u4eb2\u770b\u53ef\u4ee5\u5417\n__label__customer \u4eb2\u6709\u539f\u5473\u74dc\u5b50\u4e48\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5904\u7406\u4ee3\u7801",children:"\u5904\u7406\u4ee3\u7801"}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u6784\u5efa\u4e0b\u9762\u7684\u4e24\u4e2a\u51fd\u6570\uff0c\u6765\u8bfb\u53d6\u539f\u59cb\u7684\u6570\u636e\u6587\u4ef6\uff0c\u7136\u540e\u9010\u884c\u6309\u7167\u4e0a\u9762\u7684\u683c\u5f0f\uff0c\u6784\u5efa\u4e00\u4e2a\u5305\u542b\u4e86\u5ba2\u6237\u548c\u5ba2\u670d\u7684\u6570\u636e\u6587\u4ef6\u3002\n\u5e76\u6309\u7167fastText\u7684\u683c\u5f0f\uff0c\u4fdd\u5b58\u6210\u8bad\u7ec3\u6216\u8005\u9a8c\u8bc1\u6587\u4ef6\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def load_data(path):\n    with open(path, 'r') as f:\n        data = f.readlines()\n\n    customer_utterances = []\n    seller_utterances = []\n\n    for idx, line in tqdm(enumerate(data)):\n        utterances = line.strip().split('\\t')\n        utterances = [re.sub(r'[\\s\\n\\t]', '', utterance) for utterance in utterances]\n\n        if utterances[0] == '1':\n            customer_utterances += utterances[1::2]\n            seller_utterances += utterances[2::2]\n\n    # Remove utterances only contain digits. If it contains digits and other characters, keep it.\n    customer_utterances = [utterance for utterance in customer_utterances if not re.match(r'^[0-9]+$', utterance)]\n    seller_utterances = [utterance for utterance in seller_utterances if not re.match(r'^[0-9]+$', utterance)]\n\n    # Only keep utterances with more than 5 characters\n    customer_utterances = [utterance for utterance in customer_utterances if len(utterance) > 5]\n    seller_utterances = [utterance for utterance in seller_utterances if len(utterance) > 5]\n\n    # If the utterance are the same in both customer and seller, remove duplicates using sets\n    customer_set = set(customer_utterances)\n    seller_set = set(seller_utterances)\n    \n    # Remove duplicates that appear in both sets\n    unique_customer = list(customer_set - seller_set)\n    unique_seller = list(seller_set - customer_set)\n    \n    return unique_customer, unique_seller\n\ndef generate_fasttext_data(customer_utterances, seller_utterances, output_path):\n    \"\"\"Generate FastText training data with labels.\"\"\"\n    with open(output_path, 'w', encoding='utf-8') as f:\n        # Write customer utterances\n        for utterance in customer_utterances:\n            f.write(f\"__label__customer {utterance}\\n\")\n        \n        # Write seller utterances\n        for utterance in seller_utterances:\n            f.write(f\"__label__seller {utterance}\\n\")\n    \n    print(f\"FastText training data saved to {output_path}\")\n    print(f\"Total samples: {len(customer_utterances) + len(seller_utterances)}\")\n    print(f\"Customer samples: {len(customer_utterances)}\")\n    print(f\"Seller samples: {len(seller_utterances)}\")\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6587\u4ef6\u5904\u7406\u540e\uff0c\u5171\u6709\u8bad\u7ec3\u6570\u636e238,275\u6761\uff0c\u5176\u4e2d\u5ba2\u6237\u5bf9\u8bdd138,429\u6761\uff0c\u5ba2\u670d\u5bf9\u8bdd99,846\u6761\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u8bad\u7ec3",children:"\u8bad\u7ec3"}),"\n",(0,s.jsx)(n.h3,{id:"fasttext\u8bad\u7ec3",children:"fastText\u8bad\u7ec3"}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"fasttext.train_supervised()"}),"\u51fd\u6570\u6765\u8bad\u7ec3\u6211\u4eec\u7684\u6a21\u578b\u3002\u6bd4\u5982\uff0c\u4f7f\u7528\u5982\u4e0b\u7684\u5185\u5bb9\u8fdb\u884c\u8bad\u7ec3\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"model = fasttext.train_supervised(\n    input=input_path, \n    epoch=100, \n    lr=0.1, \n    wordNgrams=2, \n    verbose=2\n)\nmodel.save_model(output_path)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5176\u4e2d",(0,s.jsx)(n.code,{children:"input_path"}),"\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u6574\u7406\u597d\u7684\u6570\u636e\u6587\u4ef6\u3002\u5176\u4ed6\u7684\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u901a\u8fc7Ray Tune\u6765\u5e2e\u6211\u4eec\u8fdb\u884c\u5bfb\u627e\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"ray-tune\u5bfb\u627e\u53c2\u6570",children:"Ray Tune\u5bfb\u627e\u53c2\u6570"}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4e86\u4f7f\u7528Ray Tune\uff0c\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u8bad\u7ec3\u7684\u6b65\u9aa4\uff0c\u5176\u63a5\u6536\u8bad\u7ec3\u7684\u8d85\u53c2\u6570\u914d\u7f6e\uff0c\u901a\u8fc7\u5236\u5b9a\u8bad\u7ec3\u6587\u4ef6\uff0c\u4ee5\u53ca\u6d4b\u8bd5\u6587\u4ef6\u3002\n\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def get_file_size_mb(file_path):\n    """\n    Get file size in megabytes.\n    \n    Args:\n        file_path (str): Path to the file\n        \n    Returns:\n        float: File size in MB\n    """\n    size_bytes = os.path.getsize(file_path)\n    size_mb = size_bytes / (1024 * 1024)\n    return round(size_mb, 2)\n\ndef train_and_evaluate_model(config, input_path, test_path):\n    mlflow.set_tracking_uri(MLFLOW_TRACKING_URI)\n    mlflow.set_experiment("fasttext-demo-v3")\n\n    context = ray.train.get_context()\n    trial_id = context.get_trial_id()\n\n    with mlflow.start_run(run_name=f\'trial_{trial_id}\') as run:\n        model_path = f\'model_trail_{trial_id}.bin\'\n\n        training_df = convert_file_into_dataframe(input_path=input_path)\n        dataset = mlflow.data.from_pandas(\n            training_df, name=\'traing data\', targets=\'label\'\n        )\n        mlflow.log_input(dataset=dataset, context=\'training\')\n\n        mlflow.log_params(config)\n\n        # Use the dictionary\'s attributes in the function call\n        model = fasttext.train_supervised(**config)\n\n        model.save_model(model_path)\n\n        model_size_mb = get_file_size_mb(model_path)\n\n        num_of_samples, precision, recall = model.test(test_path)\n        f1_score = 2 * precision * recall / (precision + recall)\n\n        mlflow.log_metrics({\n            "f1_score": f1_score,\n            "precision": precision,\n            "recall": recall,\n            "model_size": model.get_output_matrix().size,\n            "model_size_mb": model_size_mb,\n        })\n\n        tune.report({\n            "f1_score": f1_score,\n            "precision": precision,\n            "recall": recall,\n            "model_size": model.get_output_matrix().size,\n            "model_size_mb": model_size_mb,\n            "model_path": model_path,\n        })\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u51fd\u6570",(0,s.jsx)(n.code,{children:"train_and_evaluate_model"}),"\u662f\u6211\u4eec\u7528\u6765\u8bad\u7ec3\u548c\u8bc4\u4f30fastText\u6a21\u578b\u7684\u6838\u5fc3\u51fd\u6570\uff0c\u5b83\u7ed3\u5408\u4e86MLflow\u548cRay Tune\u7684\u529f\u80fd\u3002\u8be6\u7ec6\u89e3\u6790\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u51fd\u6570\u53c2\u6570"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"config"}),"\uff1a\u5305\u542b\u6a21\u578b\u8bad\u7ec3\u53c2\u6570\u7684\u5b57\u5178"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"input_path"}),"\uff1a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"test_path"}),"\uff1a\u6d4b\u8bd5\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"MLflow\u8bbe\u7f6e"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'mlflow.set_tracking_uri(MLFLOW_TRACKING_URI)\nmlflow.set_experiment("fasttext-demo-v3")\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u8bbe\u7f6eMLflow\u7684\u8ffd\u8e2a\u670d\u52a1\u5668\u5730\u5740\u5e76\u521b\u5efa\u540d\u4e3a",(0,s.jsx)(n.code,{children:"fasttext-demo-v3"}),"\u7684\u5b9e\u9a8c\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ray Tune\u4e0a\u4e0b\u6587"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"context = ray.train.get_context()\ntrial_id = context.get_trial_id()\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u83b7\u53d6Ray Tune\u7684\u8bad\u7ec3\u4e0a\u4e0b\u6587\u548c\u8bd5\u9a8cID\uff0c\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u7684\u8bad\u7ec3\u8bd5\u9a8c\u3002\u5176\u683c\u5f0f\u4e3a8\u4f4d16\u8fdb\u5236\u7684\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\uff1a",(0,s.jsx)(n.code,{children:"01b8b86e"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6570\u636e\u51c6\u5907"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"training_df = convert_file_into_dataframe(input_path=input_path)\ndataset = mlflow.data.from_pandas(training_df, name='traing data', targets='label')\nmlflow.log_input(dataset=dataset, context='training')\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5c06\u8bad\u7ec3\u6570\u636e\u8f6c\u6362\u4e3aDataFrame\uff0c\u5e76\u521b\u5efaMLflow\u6570\u636e\u96c6\u5bf9\u8c61\u3002\n\u6b64\u6b65\u9aa4\u975e\u5fc5\u987b\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u6f14\u793a\u5982\u4f55\u4f7f\u7528MLflow\u7684",(0,s.jsx)(n.code,{children:"mlflow.log_input"}),"\u6765\u4fdd\u5b58\u8bad\u7ec3\u7684\u6570\u636e\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6a21\u578b\u8bad\u7ec3"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"model = fasttext.train_supervised(**config)\nmodel.save_model(model_path)\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u914d\u7f6e\u53c2\u6570\u8bad\u7ec3fastText\u6a21\u578b\uff0c\u5e76\u4fdd\u5b58\u6a21\u578b\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6a21\u578b\u8bc4\u4f30"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"model_size_mb = get_file_size_mb(model_path)\n\nnum_of_samples, precision, recall = model.test(test_path)\nf1_score = 2 * precision * recall / (precision + recall)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528\u6d4b\u8bd5\u6570\u636e\u8bc4\u4f30\u6a21\u578b\u6027\u80fd\uff0c\u8ba1\u7b97\u7cbe\u786e\u7387\u3001\u53ec\u56de\u7387\u548cF1\u5206\u6570\u3002\n\u540c\u65f6\u6211\u4eec\u4e5f\u901a\u8fc7\u51fd\u6570",(0,s.jsx)(n.code,{children:"get_file_size_mb"}),"\u6765\u8ba1\u7b97\u751f\u6210\u6a21\u578b\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\n\u4e3b\u8981\u662f\u8003\u8651\u65e2\u6ee1\u8db3\u6a21\u578b\u7684\u51c6\u786e\u7387\u7b49\u8981\u6c42\uff0c\u540c\u65f6\uff0c\u4e5f\u8981\u6bd4\u8f83\u5c0f\u7684\u8ba1\u7b97\u6027\u80fd\u6d88\u8017\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6307\u6807\u8bb0\u5f55"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528MLflow\u8bb0\u5f55\u53c2\u6570\u548c\u6307\u6807\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"mlflow.log_params(config)\nmlflow.log_metrics({...})\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5411Ray Tune\u62a5\u544a\u7ed3\u679c\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"tune.report({...})\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u8bb0\u5f55\u8bad\u7ec3\u53c2\u6570\u3001\u8bc4\u4f30\u6307\u6807\u548c\u6a21\u578b\u5927\u5c0f\u7b49\u4fe1\u606f\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u51fd\u6570",(0,s.jsx)(n.code,{children:"train_and_evaluate_model"}),"\u901a\u8fc7MLflow\u8ffd\u8e2a\u6bcf\u6b21\u8bad\u7ec3\u7684\u8fc7\u7a0b\u548c\u7ed3\u679c\uff0c\u540c\u65f6\u901a\u8fc7Ray Tune\u8fdb\u884c\u8d85\u53c2\u6570\u4f18\u5316\u3002\u6bcf\u6b21\u8bad\u7ec3\u90fd\u4f1a\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8bb0\u5f55\u8bad\u7ec3\u53c2\u6570"}),"\n",(0,s.jsx)(n.li,{children:"\u4fdd\u5b58\u8bad\u7ec3\u6570\u636e\u4fe1\u606f"}),"\n",(0,s.jsx)(n.li,{children:"\u8bad\u7ec3\u6a21\u578b"}),"\n",(0,s.jsx)(n.li,{children:"\u8bc4\u4f30\u6a21\u578b\u6027\u80fd"}),"\n",(0,s.jsx)(n.li,{children:"\u8bb0\u5f55\u5404\u79cd\u6307\u6807"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7MLflow\u7684UI\u754c\u9762\u67e5\u770b\u6bcf\u6b21\u8bad\u7ec3\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5e76\u901a\u8fc7Ray Tune\u627e\u5230\u6700\u4f18\u7684\u6a21\u578b\u53c2\u6570\u914d\u7f6e\u3002"}),"\n",(0,s.jsxs)(n.admonition,{title:"\u8bad\u7ec3\u6587\u4ef6\u8def\u5f84",type:"tip",children:[(0,s.jsx)(n.p,{children:"\u6211\u4eec\u5728\u4f7f\u7528Ray Tune\u8fdb\u884c\u8bad\u7ec3\u7684\u65f6\u5019\uff0c\u9700\u8981\u6ce8\u610fRay\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u8bad\u7ec3\u5f15\u64ce\uff0c\n\u56e0\u6b64\u5b83\u6709\u53ef\u80fd\u4f1a\u5728\u4e0d\u540c\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u8bad\u7ec3\u4ee3\u7801\u3002"}),(0,s.jsx)(n.p,{children:"\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u786e\u4fdd\u8bad\u7ec3\u7684\u6570\u636e\uff0c\u5728\u4e0d\u540c\u7684\u4e3b\u673a\u4e0a\u90fd\u53ef\u4ee5\u88ab\u8bbf\u95ee\u3002"}),(0,s.jsxs)(n.p,{children:["\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662f\u672c\u5730\u5355\u673a\u7684Ray\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u4e86\u7edd\u5bf9\u8def\u5f84\u6765\u63d0\u4f9b\u8bad\u7ec3\u6587\u4ef6\uff0c\u5982\uff1a\n",(0,s.jsx)(n.code,{children:"/ray-tune/data/fasttext_train.txt"}),"\u3002"]})]}),"\n",(0,s.jsx)(n.h3,{id:"\u5b9a\u4e49\u53c2\u6570\u5bfb\u627e\u8303\u56f4",children:"\u5b9a\u4e49\u53c2\u6570\u5bfb\u627e\u8303\u56f4"}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u6709\u4e86\u4e0a\u9762\u7684\u8bad\u7ec3\u51fd\u6570\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49Ray\u7684\u53c2\u6570\u8303\u56f4\uff0c\u4ee5\u53ca\u4f18\u5316\u7b56\u7565\u6765\u8bad\u7ec3\u6211\u4eec\u7684\u6a21\u578b\u4e86\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def tune_fasttext_parameters(input_path, test_path, num_samples=50):\n    ray.init()\n\n    config = {\n        "input": input_path,\n        "epoch": tune.randint(50, 300),\n        "lr": tune.loguniform(1e-5, 1e-3),  # Reduced max learning rate\n        "wordNgrams": tune.randint(1, 4),\n        "dim": tune.randint(10, 50),\n        "ws": tune.randint(3, 7),\n        "minCount": tune.randint(2, 10),\n        "minn": 1,\n        "maxn": 3,\n        "bucket": tune.choice([50000, 100000, 200000]),\n        "thread": 4,\n        "loss": "softmax",\n        "verbose": 2,\n    }\n\n    search_algo = OptunaSearch(\n        metric=["f1_score", "model_size_mb"],\n        mode=["max", "min"],\n    )\n\n    analysis = tune.run(\n        lambda trail_config: train_and_evaluate_model(trail_config, input_path, test_path),\n        config=config,\n        num_samples=num_samples,\n        search_alg=search_algo,\n        resources_per_trial={"cpu": 4}\n    )\n\n    # Get the best trial based on both metrics\n    best_trial = analysis.get_best_trial(\n        metric="f1_score",  # Primary metric\n        mode="max",\n        scope="last"  # Consider only the last reported results\n    )\n    print(f"Best trial: {best_trial}")\n\n    return best_trial\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u51fd\u6570",(0,s.jsx)(n.code,{children:"tune_fasttext_parameters"}),"\u662f\u7528\u6765\u914d\u7f6e\u548c\u6267\u884cRay Tune\u8d85\u53c2\u6570\u4f18\u5316\u7684\u4e3b\u8981\u51fd\u6570\u3002\u5176\u8be6\u7ec6\u8bbe\u7f6e\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u51fd\u6570\u53c2\u6570"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"input_path"}),"\uff1a\u8bad\u7ec3\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"test_path"}),"\uff1a\u6d4b\u8bd5\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"num_samples"}),"\uff1a\u8d85\u53c2\u6570\u641c\u7d22\u7684\u8bd5\u9a8c\u6b21\u6570\uff0c\u9ed8\u8ba4\u4e3a50\u6b21"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ray\u521d\u59cb\u5316"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"ray.init()\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521d\u59cb\u5316Ray\u8fd0\u884c\u65f6\u73af\u5883\uff0c\u4e3a\u5206\u5e03\u5f0f\u8bad\u7ec3\u505a\u51c6\u5907\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8d85\u53c2\u6570\u914d\u7f6e\u7a7a\u95f4"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'config = {\n    "input": input_path,\n    "epoch": tune.randint(50, 300),\n    "lr": tune.loguniform(1e-5, 1e-3),\n    "wordNgrams": tune.randint(1, 4),\n    ...\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5b9a\u4e49\u4e86fastText\u6a21\u578b\u7684\u5404\u4e2a\u8d85\u53c2\u6570\u7684\u641c\u7d22\u7a7a\u95f4\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"epoch"}),"\uff1a\u8bad\u7ec3\u8f6e\u6570\uff0c\u572850\u5230300\u4e4b\u95f4\u968f\u673a\u9009\u62e9\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"lr"}),"\uff1a\u5b66\u4e60\u7387\uff0c\u57281e-5\u52301e-3\u4e4b\u95f4\u6309\u5bf9\u6570\u5747\u5300\u5206\u5e03\u9009\u62e9\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"wordNgrams"}),"\uff1a\u8bcd\u7ec4\u957f\u5ea6\uff0c\u57281\u52304\u4e4b\u95f4\u9009\u62e9\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"dim"}),"\uff1a\u8bcd\u5411\u91cf\u7ef4\u5ea6\uff0c\u572810\u523050\u4e4b\u95f4\u9009\u62e9\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ws"}),"\uff1a\u4e0a\u4e0b\u6587\u7a97\u53e3\u5927\u5c0f\uff0c\u57283\u52307\u4e4b\u95f4\u9009\u62e9\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"minCount"}),"\uff1a\u6700\u5c0f\u8bcd\u9891\uff0c\u57282\u523010\u4e4b\u95f4\u9009\u62e9\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"bucket"}),"\uff1a\u54c8\u5e0c\u6876\u6570\u91cf\uff0c\u5728[50000, 100000, 200000]\u4e2d\u9009\u62e9\uff0c\u5176\u6570\u503c\u8f83\u5c0f\u53ef\u51cf\u5c11\u6a21\u578b\u5927\u5c0f\uff0c\u4f46\u662f\u5bb9\u6613\u4ea7\u751f\u51b2\u7a81\u5e76\u635f\u5931\u7279\u5f81\u4fe1\u606f\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u641c\u7d22\u7b97\u6cd5\u914d\u7f6e"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'search_algo = OptunaSearch(\n    metric=["f1_score", "model_size_mb"],\n    mode=["max", "min"],\n)\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528Optuna\u4f5c\u4e3a\u641c\u7d22\u7b97\u6cd5\uff0c\u4f18\u5316\u4e24\u4e2a\u76ee\u6807\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6700\u5927\u5316F1\u5206\u6570"}),"\n",(0,s.jsx)(n.li,{children:"\u6700\u5c0f\u5316\u6a21\u578b\u5927\u5c0f"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6267\u884c\u8d85\u53c2\u6570\u641c\u7d22"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'analysis = tune.run(\n    lambda trail_config: train_and_evaluate_model(trail_config, input_path, test_path),\n    config=config,\n    num_samples=num_samples,\n    search_alg=search_algo,\n    resources_per_trial={"cpu": 4}\n)\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u542f\u52a8\u8d85\u53c2\u6570\u641c\u7d22\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u6bcf\u6b21\u8bd5\u9a8c\u90fd\u4f1a\u8c03\u7528",(0,s.jsx)(n.code,{children:"train_and_evaluate_model"}),"\u51fd\u6570"]}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u914d\u7f6e\u7684\u53c2\u6570\u7a7a\u95f4\u8fdb\u884c\u641c\u7d22"}),"\n",(0,s.jsx)(n.li,{children:"\u6267\u884c\u6307\u5b9a\u6b21\u6570\u7684\u8bd5\u9a8c"}),"\n",(0,s.jsx)(n.li,{children:"\u6bcf\u4e2a\u8bd5\u9a8c\u5206\u914d4\u4e2aCPU\u6838\u5fc3"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u83b7\u53d6\u6700\u4f73\u7ed3\u679c"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'best_trial = analysis.get_best_trial(\n    metric="f1_score",\n    mode="max",\n    scope="last"\n)\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4ece\u6240\u6709\u8bd5\u9a8c\u4e2d\u9009\u62e9\u6700\u4f73\u7ed3\u679c\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e3b\u8981\u57fa\u4e8eF1\u5206\u6570\u8fdb\u884c\u9009\u62e9"}),"\n",(0,s.jsx)(n.li,{children:"\u9009\u62e9F1\u5206\u6570\u6700\u9ad8\u7684\u8bd5\u9a8c"}),"\n",(0,s.jsx)(n.li,{children:"\u53ea\u8003\u8651\u6bcf\u4e2a\u8bd5\u9a8c\u7684\u6700\u540e\u4e00\u6b21\u7ed3\u679c"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u4e2a\u51fd\u6570\u901a\u8fc7Ray Tune\u7684\u8d85\u53c2\u6570\u4f18\u5316\u529f\u80fd\uff0c\u81ea\u52a8\u641c\u7d22\u6700\u4f73\u7684fastText\u6a21\u578b\u53c2\u6570\u914d\u7f6e\u3002\u5b83\u4e0d\u4ec5\u8003\u8651\u4e86\u6a21\u578b\u7684\u6027\u80fd\uff08F1\u5206\u6570\uff09\uff0c\n\u8fd8\u8003\u8651\u4e86\u6a21\u578b\u7684\u5927\u5c0f\uff0c\u8fd9\u6837\u53ef\u4ee5\u5728\u6027\u80fd\u548c\u8d44\u6e90\u6d88\u8017\u4e4b\u95f4\u627e\u5230\u4e00\u4e2a\u826f\u597d\u7684\u5e73\u8861\u70b9\u3002"}),"\n",(0,s.jsxs)(n.admonition,{title:"\u591a\u76ee\u6807\u4f18\u5316",type:"tip",children:[(0,s.jsx)(n.p,{children:"\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86Optuna\u4f5c\u4e3a\u641c\u7d22\u7b97\u6cd5\uff0c\u5e76\u8bbe\u7f6e\u4e86\u4e24\u4e2a\u4f18\u5316\u76ee\u6807\uff1aF1\u5206\u6570\u548c\u6a21\u578b\u5927\u5c0f\u3002\n\u8fd9\u79cd\u591a\u76ee\u6807\u4f18\u5316\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5728\u6a21\u578b\u6027\u80fd\u548c\u8d44\u6e90\u6d88\u8017\u4e4b\u95f4\u627e\u5230\u66f4\u597d\u7684\u5e73\u8861\u3002"}),(0,s.jsx)(n.p,{children:"\u4f46\u662f\u5728\u6700\u7ec8\u9009\u62e9\u6700\u4f73\u8bd5\u9a8c\u65f6\uff0c\u6211\u4eec\u4ecd\u7136\u4e3b\u8981\u57fa\u4e8eF1\u5206\u6570\u8fdb\u884c\u9009\u62e9\u3002\u8fd9\u662f\u56e0\u4e3a\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\n\u6211\u4eec\u901a\u5e38\u4f1a\u4f18\u5148\u8003\u8651\u6a21\u578b\u7684\u6027\u80fd\uff0c\u53ea\u8981\u6a21\u578b\u5927\u5c0f\u5728\u53ef\u63a5\u53d7\u7684\u8303\u56f4\u5185\u5373\u53ef\u3002"})]}),"\n",(0,s.jsx)(n.h2,{id:"\u53ef\u9009\u6b65\u9aa4",children:"\u53ef\u9009\u6b65\u9aa4"}),"\n",(0,s.jsx)(n.h3,{id:"\u5bf9\u8bad\u7ec3\u5f02\u5e38\u8fdb\u884c\u5904\u7406",children:"\u5bf9\u8bad\u7ec3\u5f02\u5e38\u8fdb\u884c\u5904\u7406"}),"\n",(0,s.jsx)(n.p,{children:"\u7531\u4e8efastText\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u4f1a\u62a5\u9519\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u9488\u5bf9\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38\u8fdb\u884c\u6355\u83b7\uff0c\u7136\u540e\u8fdb\u884c\u9488\u5bf9\u6027\u7684\u5904\u7406\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'def train_and_evaluate_model(config, input_path, test_path):\n    # ...\n        try:\n            # Use the dictionary\'s attributes in the function call\n            model = fasttext.train_supervised(**config)\n\n            model.save_model(model_path)\n\n            model_size_mb = get_file_size_mb(model_path)\n\n            num_of_samples, precision, recall = model.test(test_path)\n            f1_score = 2 * precision * recall / (precision + recall)\n\n            mlflow.log_metrics({\n                "f1_score": f1_score,\n                "precision": precision,\n                "recall": recall,\n                "model_size": model.get_output_matrix().size,\n                "model_size_mb": model_size_mb,\n            })\n\n            tune.report({\n                "f1_score": f1_score,\n                "precision": precision,\n                "recall": recall,\n                "model_size": model.get_output_matrix().size,\n                "model_size_mb": model_size_mb,\n                "model_path": model_path,\n            })\n        except Exception as e:\n            print(f"Error: {e}")\n            mlflow.log_param(\'error_message\', str(e))\n            mlflow.log_metric(\'failed\', 1)\n\n            tune.report({\n                "f1_score": -1,\n                "precision": -1,\n                "recall": -1,\n                "model_size": -1,\n                "model_size_mb": sys.float_info.max,\n                "model_path": model_path,\n            })\n    # ...\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86",(0,s.jsx)(n.code,{children:"try...except"}),"\u8bed\u53e5\u6765\u5904\u7406\u5f02\u5e38\uff0c\u5c24\u5176\u662f\u5728\u5f02\u5e38\u540e\uff0c\n\u6211\u4eec\u4f1a\u8bb0\u5f55\u5f02\u5e38\u7684\u539f\u56e0\uff0c\u540c\u65f6\u5229\u7528",(0,s.jsx)(n.code,{children:"tune.report"}),"\u6765\u544a\u77e5\u4f18\u5316\u5668\uff0c\u8be5\u53c2\u6570\u7ec4\u5408\u53ef\u80fd\u4f1a\u9020\u6210\u5f02\u5e38\u3002\n\u56e0\u6b64\uff0c\u5e94\u5f53\u5c3d\u91cf\u89c4\u907f\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u8bb0\u5f55\u6a21\u578b",children:"\u8bb0\u5f55\u6a21\u578b"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u8bad\u7ec3\u5e76\u9a8c\u8bc1\u540e\uff0c\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u4fdd\u5b58\u6a21\u578b\u7684\u6a21\u578b\u6587\u4ef6\uff0c\u56e0\u6b64\u901a\u8fc7\u6784\u9020\u652f\u6301",(0,s.jsx)(n.code,{children:"mlflow.pyfunc.log_model"}),"\u7684\u5305\u88c5\u5668\uff0c\n\u6211\u4eec\u53ef\u4ee5\u5feb\u6377\u7684\u4fdd\u5b58\u5e76\u6ce8\u518c\u6a21\u578b\u6587\u4ef6\u3002\u4f8b\u5982\u6211\u4eec\u6784\u9020\u7684\u5305\u88c5\u5668\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'class FastTextWrapper(mlflow.pyfunc.PythonModel):\n    def load_context(self, context):\n        self.model = fasttext.load_model(context.artifacts["fasttext_model"])\n    \n    def predict(self, context, model_input):\n        predictions = []\n        for text in model_input["text"]:\n            label, prob = self.model.predict(text)\n            predictions.append({"label": label[0], "probability": prob[0]})\n        return predictions\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u6a21\u578b\u8bad\u7ec3\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53ca\u65f6\u6ce8\u518c\u6a21\u578b\u6587\u4ef6\uff0c\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# Log the model as an artifact\nmlflow.log_artifact(model_path, "model")\n\nmlflow.pyfunc.log_model(\n    artifact_path="fasttext_model",\n    python_model=FastTextWrapper(),\n    artifacts={\n        "fasttext_model": model_path\n    },\n    registered_model_name="fasttext_classifier"\n)\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6837\uff0c\u5728\u6211\u4eec\u7684MLflow\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u67e5\u770b\u5230\u67d0\u4e00\u4e2a\u8fd0\u884c\u7ed3\u679c\u6240\u5bf9\u5e94\u7684\u6a21\u578b\u6587\u4ef6\u4fe1\u606f\u4e86\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u800c\u4e14\uff0c\u4e5f\u65b9\u4fbf\u6211\u4eec\u540e\u7eed\u4f7f\u7528\u54cd\u5e94\u7684\u6a21\u578b\u7ed3\u679c\u7528\u4e8e\u9a8c\u8bc1\u7b49\u76ee\u7684\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u7ed3\u679c\u89e3\u6790",children:"\u7ed3\u679c\u89e3\u6790"}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u6253\u5f00MLflow\u7684\u540e\u53f0\uff0c\u901a\u8fc7\u68c0\u7d22\u8fc7\u6ee4\u6ee1\u8db3\uff1a",(0,s.jsx)(n.code,{children:"metrics.model_size_mb < 5"}),"\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6211\u4eec\u5f97\u523071\u4e2a\u8fd0\u884c\u7ed3\u679c\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"MLflow Result",src:t(9537).A+"",width:"1918",height:"1078"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u6309\u7167",(0,s.jsx)(n.code,{children:"model_size_mb"}),"\u8fdb\u884c\u6392\u5e8f\uff0c\u53ef\u4ee5\u627e\u5230\u6700\u5c0f\u6a21\u578b\u5927\u5c0f\u7684\u6587\u4ef6\uff0c\u7136\u540e\u6211\u4eec\u901a\u8fc7\u68c0\u67e5",(0,s.jsx)(n.code,{children:"f1_score"}),"\u7684\u7ed3\u679c\uff0c\u53ef\u4ee5\u83b7\u5f97\u76f8\u5e94\u7684\u8bad\u7ec3\u53c2\u6570\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u4f7f\u7528Ray Tune\u4ee5\u53caMLflow\uff0c\u5b9e\u73b0\u4e86\u9488\u5bf9fastText\u7684\u8bad\u7ec3\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u540c\u65f6\u501f\u52a9\u53c2\u6570\u5bfb\u627e\u4f18\u5316\u7b56\u7565\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u7684\u627e\u5230\u8ba9\u6211\u4eec\u6ee1\u610f\u7684\u53c2\u6570\u7a7a\u95f4\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8356:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var l=t(6672);const s={},r=l.createContext(s);function i(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),l.createElement(r.Provider,{value:n},e.children)}},9537:(e,n,t)=>{t.d(n,{A:()=>l});const l=t.p+"assets/images/mlflow-result-2d49c485bc45296c94696af5f66fc7f3.png"}}]);